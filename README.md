# Epub2Summary

一个平平无奇的Epub文件总结助手，按章节切分成MD格式，然后利用大语言模型进行总结。主要考虑到：1.大语言模型更青睐于MD格式；2.即便模型上下文长度绰绰有余，直接总结整本书的效果并不会比按章节总结好。
本程序主要是Vibe coding的产物。

## 功能特点

### 📖 智能章节检测
- **XPath方法**：基于HTML结构的精确章节检测，支持自定义XPath表达式
- **正则表达式方法**：灵活的文本匹配，支持中英文多种章节格式
- **TOC目录方法**：直接使用EPUB文件内置的目录结构
- **自由切换**：在图形化界面中一键切换检测方法

### 🤖 AI总结生成
- 集成OpenAI API，支持自定义模型和提示词
- 自动为每个章节生成高质量总结
- 生成全书总览，整合所有章节总结

### 🎨 用户友好界面
- 直观的图形化界面（PyQt6）
- 章节选择功能，支持自定义处理范围
- 实时进度显示和日志记录
- 自动保存处理结果

## 安装步骤

### 1. 克隆项目

```bash
git clone <项目地址>
cd epub2summary
```

### 2. 安装依赖

```bash
pip install -r requirements.txt
```
### 3. 运行
```bash
python main.py
```


### 4. 配置API密钥

首次运行程序后，在"设置"菜单中配置OpenAI API相关参数：
- API Base URL
- API Key
- 模型名称（默认：gpt-3.5-turbo）
- 系统提示词（默认："请总结以下小说章节的核心剧情，保留关键人物和冲突。"）

## 使用方法

### 基本流程

1. **选择EPUB文件**：点击"浏览"按钮选择要处理的EPUB文件
2. **选择输出目录**：指定处理结果的保存位置
3. **选择检测方法**：在"章节检测方案"中选择要使用的章节检测方法
4. **开始处理**：点击"开始处理"按钮
5. **选择章节**：在弹出的章节选择对话框中选择要处理的章节
6. **等待完成**：程序会自动完成章节检测、Markdown转换和AI总结生成

### 详细操作说明

#### 1. 章节检测方案选择

在主界面中，您可以选择以下三种章节检测方法：

- **XPath**：适用于结构规范的EPUB文件，准确率高
- **正则表达式**：适用于结构不规范的文件，适应性强
- **TOC目录**：适用于包含完整目录结构的文件，可靠性最高

选择后，章节选择对话框会使用该方法显示检测到的章节列表。

#### 2. 章节选择

- 自动全选所有检测到的章节
- 可以取消选择不需要处理的章节
- 点击"全选"按钮快速切换选择状态

#### 3. 进度查看

- 进度条显示当前处理进度
- 日志区域显示详细的处理信息
- 处理完成后会显示成功提示

## 功能详解

### 章节检测算法

#### XPath方法

使用以下XPath表达式检测章节：

```xpath
//*[((name()='h1' or name()='h2') and re:test(., '\s*((chapter|book|section|part)\s+)|((prolog|prologue|epilogue)(\s+|$))', 'i')) or @class = 'chapter']
```

#### 正则表达式方法

使用以下正则表达式匹配章节标题：

```python
r'^(?:(.+[ 　]+)|())(第[一二三四五六七八九十零〇百千万两0123456789]+[章卷]|卷[一二三四五六七八九十零〇百千万两0123456789]+|chap(?:ter)\.?|vol(?:ume)?\.?|book|bk)(?:[ 　]+(?:\S.*)?)?[ 　]*$'
```

### AI总结生成

程序会为每个章节生成独立的总结文件，并最终合并为全书总览：

- 每个章节的总结保存为`章节标题_summary.md`
- 全书总览保存为`summary.md`
- 总览文件包含目录和各章节总结

### 输出文件结构

```
output/
├── 第一章_简介.md
├── 第一章_简介_summary.md
├── 第二章_发展.md
├── 第二章_发展_summary.md
├── ...
└── summary.md
```

## 技术栈

- **Python 3.8+**：主要开发语言
- **PyQt6**：图形用户界面
- **ebooklib**：EPUB文件解析
- **BeautifulSoup4**：HTML解析
- **lxml**：XPath支持
- **OpenAI API**：AI总结生成
- **requests**：HTTP请求

## 配置文件

配置信息保存在`config.json`文件中：

```json
{
  "api_base": "https://api.openai.com",
  "api_key": "your_api_key",
  "model_name": "gpt-3.5-turbo",
  "system_prompt": "请总结以下小说章节的核心剧情，保留关键人物和冲突。"
}
```

您可以通过图形界面的"设置"菜单来修改这些配置。

## 常见问题

### 1. 为什么三种检测方法结果相同？

这可能是因为您的EPUB文件在使用不同方法检测时都能得到相同的结果。您可以查看日志输出，确认当前使用的检测方法。

### 2. 如何提高章节检测的准确性？

- 对于规范的EPUB文件，推荐使用XPath方法
- 对于结构复杂的文件，尝试使用正则表达式方法
- 确保EPUB文件包含完整的目录结构
- 三种方式都无法获取正确章节？很多epub图书可能本身就是通过PDF、azw、mobi等转换而来的，格式不规范，大概率无解，除非手动规范原书章节目录。

### 3. AI总结生成失败怎么办？

- 检查API密钥是否正确
- 确保网络连接正常
- 调整API参数，如增大超时时间

### 4. 如何自定义章节检测规则？

您可以修改`epub_handler.py`文件中的相关代码：
- XPath表达式：修改`split_by_xpath`方法
- 正则表达式：修改`chapter_regex`属性

## 许可证

本项目采用MIT许可证，详情请参考LICENSE文件。


## 贡献

欢迎提交Issue和Pull Request来帮助改进这个项目！



---

感谢使用Epub2Summary！📚✨
